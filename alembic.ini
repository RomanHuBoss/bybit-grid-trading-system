# Alembic configuration file for Bybit Algo-Grid / AVI-5
# ВНИМАНИЕ:
# - эта конфигурация предназначена прежде всего для локальной разработки и dev/sandbox;
# - для продакшена DSN и уровень логирования должны переопределяться через окружение /
#   внешнюю конфигурацию (см. раздел про deployment).

[alembic]
# Путь до каталога со скриптами миграций (см. 7.39. alembic/)
script_location = alembic

# DSN используется Alembic для подключения к PostgreSQL.
# Для локальной разработки можно использовать тестовую БД:
#   postgres / postgres @ localhost:5432 / avi5
# В боевом окружении строка подключения должна задаваться отдельно.
sqlalchemy.url = postgresql+psycopg2://postgres:postgres@localhost:5432/avi5

# Временная зона для меток времени миграций
timezone = UTC

# Шаблон имени ревизии (дата + ревизия + slug)
file_template = %%(year)d%%(month).2d%%(day).2d_%%(rev)s_%%(slug)s

# Ограничение длины slug в имени файла
truncate_slug_length = 40

# Кодировка вывода
output_encoding = utf-8

###########################################################################
# Logging configuration
#
# Alembic использует стандартный logging.config.fileConfig. Здесь задаются
# логгеры для:
#   - alembic.*  — собственные сообщения миграций
#   - sqlalchemy.engine — SQL, исполняемый в рамках миграций
###########################################################################

[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console,file

[formatters]
keys = generic

[logger_root]
level = WARN
handlers = console

[logger_sqlalchemy]
level = WARN
handlers = console
qualname = sqlalchemy.engine

[logger_alembic]
level = INFO
handlers = console,file
qualname = alembic

[handler_console]
class = StreamHandler
level = NOTSET
formatter = generic
args = (sys.stdout,)

[handler_file]
class = FileHandler
# Локальный лог для аудита миграций.
# Путь относителен корня репозитория (см. каталог logs/).
level = INFO
formatter = generic
args = ('logs/alembic.log', 'a')

[formatter_generic]
format = %(asctime)s [%(levelname)s] %(name)s - %(message)s
datefmt = %Y-%m-%d %H:%M:%S
