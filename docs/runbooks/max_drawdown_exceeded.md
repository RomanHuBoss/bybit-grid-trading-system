<!-- docs/runbooks/max_drawdown_exceeded.md -->

# Runbook: Превышен лимит просадки (`max_drawdown_exceeded`)

## 1. Контекст

Алерт `max_drawdown_exceeded` означает, что достигнут или превышен лимит MaxDD,
согласованный с риск-профилем стратегии. В спецификации предусмотрена автоостановка
(взаимодействие с kill-switch) при слишком большой просадке.

## 2. Как распознать проблему

1. Алерт `max_drawdown_exceeded` в бизнес-метриках.
2. На дашборде:
   - `strategy_max_drawdown` ≥ установленного лимита (например, 25%);
   - возможно, активирован kill-switch.

## 3. Пошаговые действия

1. Убедиться, что расчёт equity/MaxDD корректен:
   - нет ли «дыр» или дублей сделок;
   - правильно ли учитываются комиссии, частичные закрытия и пр.
2. Проверить, есть ли активные позиции:
   - оценить их риск и потенциальное влияние на дальнейшую просадку.
3. Проверить, был ли автоматически задействован kill-switch:
   - если нет, рассмотреть ручное включение.

## 4. Митигация

1. При активных позициях:
   - сократить риск (частично закрыть или уменьшить размер позиций);
   - при необходимости — закрыть все позиции по рынку.
2. Остановить открытие новых позиций:
   - включить kill-switch (если ещё не включён).
3. Зафиксировать состояние:
   - equity до/после действий;
   - список активных и закрытых позиций.

## 5. Пост-инцидент и перезапуск

1. Совместно с владельцем стратегии и квантом:
   - провести детальный разбор (market regime, поведение модели, исполнение);
   - определить, нужны ли изменения в логике/параметрах.
2. Принять решение:
   - перезапуск стратегии в текущем виде;
   - перекалибровка и перезапуск;
   - полная остановка.
3. При перезапуске:
   - явно задокументировать новые лимиты MaxDD/Net Expectancy и условия автоостановки.
