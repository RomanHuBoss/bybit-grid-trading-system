<!-- docs/runbooks/bybit_latency_degraded.md -->

# Runbook: Деградация latency Bybit (`bybit_latency_degraded`)

## 1. Контекст

Алерт `bybit_latency_degraded` означает устойчивый рост времени ответа Bybit API.  
Риски: задержка открытия/закрытия позиций, увеличение проскальзывания.

## 2. Как распознать проблему

1. Сработал алерт `bybit_latency_degraded`.
2. В Grafana:
   - рост `bybit_http_latency_p95/p99` выше порогов из `docs/load_testing.md`;
   - spike’и времени закрытия/открытия позиций.
3. В логах нет массовых 4xx/5xx, но постоянно большие таймауты.

## 3. Пошаговые действия

1. Проверить статус Bybit и сетевую доступность (ping/traceroute к endpoint’ам).
2. Сверить изменения:
   - не выкатывался ли код, который увеличивает payload/частоту запросов;
   - не менялись ли параметры таймаутов/ретраев.
3. При подозрении на проблемы сети/провайдера:
   - проверить соседние сервисы в том же кластере/ЦОД.

## 4. Митигация

1. Увеличить таймауты аккуратно (если они были слишком агрессивны) — в пределах разумного.
2. Снизить частоту запросов необязательных фоновых задач (пуллинг балансов, агрегации).
3. При существенной деградации:
   - обсудить с владельцем стратегии временное уменьшение объёма торговли;
   - контролировать slippage-метрики.

## 5. Проверка восстановления

- latency вернулась к целевым уровням;
- нет всплеска `slippage_bps` и `order_rejections`;
- алерт погас и не вспыхивает вторично при той же нагрузке.
